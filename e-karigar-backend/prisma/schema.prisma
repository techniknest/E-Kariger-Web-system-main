generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String          @id @default(uuid())
  name            String
  email           String          @unique
  phone           String?         @unique
  password_hash   String
  role            UserRole
  is_active       Boolean         @default(true)
  created_at      DateTime        @default(now())
  updated_at      DateTime        @updatedAt
  admin_logs      AdminAuditLog[]
  client_bookings Booking[]       @relation("ClientBookings")
  sent_messages   ChatMessage[]
  reviews_written Review[]
  vendor_profile  VendorProfile?

  @@map("users")
}

model VendorProfile {
  id                   String                   @id @default(uuid())
  user_id              String                   @unique
  vendor_type          String                   @default("INDIVIDUAL")
  approval_status      VendorVerificationStatus @default(PENDING)
  description          String?
  city                 String?
  is_verified          Boolean                  @default(false)
  verification_badge   Boolean                  @default(false)
  created_at           DateTime                 @default(now())
  updated_at           DateTime                 @updatedAt
  business_phone       String?
  cnic                 String?                  @unique
  experience_years     Int?
  vendor_bookings      Booking[]                @relation("VendorBookings")
  reviews_received     Review[]
  services             Service[]
  user                 User                     @relation(fields: [user_id], references: [id])
  verification_records VerificationRecord[]

  @@map("vendor_profiles")
}

model Category {
  id        String    @id @default(uuid())
  name      String
  is_active Boolean   @default(true)
  services  Service[]

  @@map("categories")
}

model Service {
  id          String        @id @default(uuid())
  vendor_id   String
  category_id String
  title       String
  description String?
  price       Decimal       @db.Decimal(10, 2)
  images      String[]      @default([])
  is_active   Boolean       @default(true)
  created_at  DateTime      @default(now())
  updated_at  DateTime      @updatedAt
  bookings    Booking[]
  category    Category      @relation(fields: [category_id], references: [id])
  vendor      VendorProfile @relation(fields: [vendor_id], references: [id])

  @@map("services")
}

model Booking {
  id                  String             @id @default(uuid())
  client_id           String
  vendor_id           String
  service_id          String
  status              BookingStatus      @default(PENDING)
  created_at          DateTime           @default(now())
  updated_at          DateTime           @updatedAt
  address             String
  problem_description String
  scheduled_date      DateTime
  total_price         Decimal            @db.Decimal(10, 2)
  start_otp           String?
  final_price         Decimal?           @db.Decimal(10, 2)
  is_price_revised    Boolean            @default(false)
  revision_reason     String?
  status_logs         BookingStatusLog[]
  client              User               @relation("ClientBookings", fields: [client_id], references: [id])
  service             Service            @relation(fields: [service_id], references: [id])
  vendor              VendorProfile      @relation("VendorBookings", fields: [vendor_id], references: [id])
  chat_room           ChatRoom?
  review              Review?

  @@map("bookings")
}

model BookingStatusLog {
  id         String         @id @default(uuid())
  booking_id String
  old_status BookingStatus?
  new_status BookingStatus
  changed_by String
  changed_at DateTime       @default(now())
  booking    Booking        @relation(fields: [booking_id], references: [id])

  @@map("booking_status_logs")
}

model ChatRoom {
  id         String        @id @default(uuid())
  booking_id String        @unique
  created_at DateTime      @default(now())
  messages   ChatMessage[]
  booking    Booking       @relation(fields: [booking_id], references: [id])

  @@map("chat_rooms")
}

model ChatMessage {
  id         String   @id @default(uuid())
  room_id    String
  sender_id  String
  message    String
  created_at DateTime @default(now())
  room       ChatRoom @relation(fields: [room_id], references: [id])
  sender     User     @relation(fields: [sender_id], references: [id])

  @@map("chat_messages")
}

model Review {
  id         String        @id @default(uuid())
  booking_id String        @unique
  client_id  String
  vendor_id  String
  rating     Int
  comment    String?
  created_at DateTime      @default(now())
  booking    Booking       @relation(fields: [booking_id], references: [id])
  client     User          @relation(fields: [client_id], references: [id])
  vendor     VendorProfile @relation(fields: [vendor_id], references: [id])

  @@map("reviews")
}

model VerificationRecord {
  id           String        @id @default(uuid())
  vendor_id    String
  document_url String
  status       String
  reviewed_by  String?
  reviewed_at  DateTime?
  vendor       VendorProfile @relation(fields: [vendor_id], references: [id])

  @@map("verification_records")
}

model AdminAuditLog {
  id          String   @id @default(uuid())
  admin_id    String
  action      String
  target_type String
  target_id   String
  created_at  DateTime @default(now())
  admin       User     @relation(fields: [admin_id], references: [id])

  @@map("admin_audit_logs")
}

enum UserRole {
  ADMIN
  VENDOR
  CLIENT
}

enum BookingStatus {
  PENDING
  ACCEPTED
  REJECTED
  IN_PROGRESS
  WAITING_APPROVAL
  COMPLETED
  CANCELLED
}

enum VendorVerificationStatus {
  PENDING
  APPROVED
  REJECTED
}
